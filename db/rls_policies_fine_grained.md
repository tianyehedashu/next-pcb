# Fine-grained RLS Policy 说明

本文件对应 `db/rls_policies_fine_grained.sql`，用于详细说明每条 RLS（Row Level Security）策略的业务意义和适用场景。

---

## addresses 表

- **select/update/delete**：用户只能查询、修改、删除自己的地址（`user_id = auth.uid()`）。
  - 业务意义：防止用户越权访问或篡改他人地址。
- **insert**：只允许插入属于自己的地址（`user_id = auth.uid()`）。
  - 业务意义：防止伪造 user_id 插入他人数据。
- **管理员策略**：管理员（JWT `role=admin` 或 service_role）可管理所有地址。
  - 业务意义：便于后台客服/管理员处理用户地址问题。

## customs_declarations 表

- **select/update/delete**：用户只能操作自己的报关信息。
  - 业务意义：保护用户隐私，防止信息泄露。
- **insert**：只允许插入属于自己的报关信息。
  - 业务意义：防止伪造 user_id。
- **管理员策略**：管理员可管理所有报关信息。
  - 业务意义：便于合规审核、客服介入。

## orders 表

- **select**：用户只能查询自己的订单。
  - 业务意义：保护订单隐私。
- **insert**：用户只能插入属于自己的订单。
  - 业务意义：防止伪造 user_id。
- **update/delete**：用户只能更新/删除自己未支付（pending）订单。
  - 业务意义：订单一旦支付或进入生产流程，用户不能再随意更改或删除，保证业务流程安全。
- **管理员策略**：管理员可管理所有订单。
  - 业务意义：便于订单审核、售后处理、异常订单介入。

---

## 适用场景
- 适合 B2B/B2C 海外独立站，保护用户数据安全，防止越权。
- 管理员可通过 JWT claim 或 service_role 访问所有数据，便于后台管理。
- 可根据业务需求进一步细化（如客服角色、只读公开等）。

如需更复杂的权限模型（如多角色、部分字段可改、订单状态流转等），可在此基础上扩展。 