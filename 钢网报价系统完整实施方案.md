# Èí¢ÁΩëÊä•‰ª∑Á≥ªÁªüÂÆåÊï¥ÂÆûÊñΩÊñπÊ°à

## üìã È°πÁõÆÊ¶ÇËø∞

Âú®Áé∞ÊúâPCBÊä•‰ª∑Á≥ªÁªü (`quote2`) Âü∫Á°Ä‰∏äÔºåÊñ∞Â¢ûÈí¢ÁΩëÊä•‰ª∑ÂäüËÉΩÔºåÂÆûÁé∞"‰∏Ä‰∏™È°µÈù¢Ôºå‰∏§Áßç‰∫ßÂìÅ"ÁöÑÁªü‰∏ÄÊä•‰ª∑‰ΩìÈ™åÔºåÊúÄÂ∞èÂåñÂØπÁé∞ÊúâÁ≥ªÁªüÁöÑÊîπÂä®„ÄÇ

## üéØ ËÆæËÆ°ÂéüÂàô

1. **ÊúÄÂ∞èÊîπÂä®ÂéüÂàô**Ôºö‰øùÊåÅÁé∞Êúâ‰ª£Á†ÅÁªìÊûÑÔºåÈÄöËøáÊâ©Â±ïËÄåÈùûÈáçÊûÑÂÆûÁé∞
2. **Êï∞ÊçÆÂ∫ìÂÖºÂÆπ**ÔºöÁªßÁª≠‰ΩøÁî® `pcb_quotes` Ë°®ÔºåÈÄöËøá `productType` Â≠óÊÆµÂå∫ÂàÜ
3. **ÁªÑ‰ª∂Â§çÁî®**ÔºöÂú∞ÂùÄË°®Âçï„ÄÅÊñá‰ª∂‰∏ä‰º†„ÄÅÊîØ‰ªòÊµÅÁ®ãÁ≠âÁªÑ‰ª∂100%Â§çÁî®
4. **ËÆ°ÁÆóÁã¨Á´ã**ÔºöÈí¢ÁΩëÊúâÁã¨Á´ãÁöÑ‰ª∑Ê†º„ÄÅ‰∫§Êúü„ÄÅËøêË¥πËÆ°ÁÆóÈÄªËæë
5. **Á±ªÂûãÂÆâÂÖ®**ÔºöTypeScriptÁ°Æ‰øùÂêÑ‰∫ßÂìÅÁ±ªÂûãÁöÑÂ≠óÊÆµÂÆâÂÖ®

## üèóÔ∏è Á≥ªÁªüÊû∂ÊûÑ

### 1. Êï∞ÊçÆÂ±ÇËÆæËÆ°

#### A. Êï∞ÊçÆÂ∫ìÁªìÊûÑÔºà‰øùÊåÅ‰∏çÂèòÔºâ
```sql
-- ÁªßÁª≠‰ΩøÁî®Áé∞Êúâ pcb_quotes Ë°®
-- pcb_spec Â≠óÊÆµÂ≠òÂÇ®ÊâÄÊúâ‰∫ßÂìÅËßÑÊ†ºÔºåÈÄöËøá productType Âå∫ÂàÜ

{
  "productType": "stencil",  // ‰∫ßÂìÅÁ±ªÂûãÊ†áËØÜ
  "stencilMaterial": "ss304",
  "stencilThickness": 0.12,
  "stencilProcess": "laser_cut",
  // ÂÖ¨ÂÖ±Â≠óÊÆµ
  "singleDimensions": {"length": 100, "width": 80},
  "singleCount": 10,
  "shippingAddress": {...}
}
```

#### B. Á±ªÂûãÂÆö‰πâÊâ©Â±ï
```typescript
// Êñ∞Â¢û‰∫ßÂìÅÁ±ªÂûãÊûö‰∏æ
export enum ProductType {
  PCB = 'pcb',
  STENCIL = 'stencil'
}

// Èí¢ÁΩëÁâπÊúâÂ≠óÊÆµÊûö‰∏æ
export enum StencilMaterial {
  STAINLESS_STEEL_304 = 'ss304',
  STAINLESS_STEEL_316L = 'ss316l',
  NICKEL = 'nickel'
}

export enum StencilThickness {
  T0_08 = 0.08,
  T0_10 = 0.10,
  T0_12 = 0.12,
  T0_15 = 0.15,
  T0_20 = 0.20
}

export enum StencilProcess {
  LASER_CUT = 'laser_cut',
  ELECTROFORM = 'electroform',
  CHEMICAL_ETCH = 'chemical_etch'
}

export enum FrameType {
  NO_FRAME = 'no_frame',
  SMT_FRAME = 'smt_frame',
  CUSTOM_FRAME = 'custom_frame'
}
```

### 2. ÂâçÁ´ØÊû∂ÊûÑ

#### A. ÁªÑ‰ª∂ÁªìÊûÑ
```
app/quote2/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ProductTypeSelector.tsx     # Êñ∞Â¢ûÔºö‰∫ßÂìÅÁ±ªÂûãÈÄâÊã©Âô®
‚îÇ   ‚îú‚îÄ‚îÄ QuoteForm.tsx              # ‰øÆÊîπÔºöÊîØÊåÅÂä®ÊÄÅschema
‚îÇ   ‚îú‚îÄ‚îÄ PriceSummary.tsx           # ‰øÆÊîπÔºöÊîØÊåÅÂ§ö‰∫ßÂìÅËÆ°ÁÆó
‚îÇ   ‚îî‚îÄ‚îÄ ...existing components     # ‰øùÊåÅ‰∏çÂèò
‚îú‚îÄ‚îÄ schema/
‚îÇ   ‚îú‚îÄ‚îÄ pcbFormilySchema.ts        # ‰øùÊåÅ‰∏çÂèò
‚îÇ   ‚îú‚îÄ‚îÄ stencilFormilySchema.ts    # Êñ∞Â¢ûÔºöÈí¢ÁΩëÂ≠óÊÆµÂÆö‰πâ
‚îÇ   ‚îú‚îÄ‚îÄ stencilTypes.ts            # Êñ∞Â¢ûÔºöÈí¢ÁΩëÁ±ªÂûãÂÆö‰πâ
‚îÇ   ‚îî‚îÄ‚îÄ productSchemas.ts          # Êñ∞Â¢ûÔºöÁªü‰∏ÄschemaÁÆ°ÁêÜ
‚îî‚îÄ‚îÄ hooks/
    ‚îú‚îÄ‚îÄ useProductCalculation.ts   # Êñ∞Â¢ûÔºöÁªü‰∏ÄËÆ°ÁÆóhook
    ‚îî‚îÄ‚îÄ ...existing hooks          # ‰øùÊåÅ‰∏çÂèò
```

#### B. Ê†∏ÂøÉÂÆûÁé∞Êñá‰ª∂

**1. ‰∫ßÂìÅÁ±ªÂûãÈÄâÊã©Âô®**
```typescript
// app/quote2/components/ProductTypeSelector.tsx
interface ProductTypeSelectorProps {
  value: ProductType;
  onChange: (type: ProductType) => void;
}

export const ProductTypeSelector = ({ value, onChange }: ProductTypeSelectorProps) => {
  return (
    <div className="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
      <h2 className="text-xl font-semibold mb-4 text-gray-800">Select Product Type</h2>
      <div className="grid grid-cols-2 gap-4">
        <ProductTypeCard
          type={ProductType.PCB}
          icon="üîß"
          title="PCB Manufacturing"
          description="Professional circuit board fabrication"
          isSelected={value === ProductType.PCB}
          onClick={() => onChange(ProductType.PCB)}
        />
        <ProductTypeCard
          type={ProductType.STENCIL}
          icon="üìê"
          title="Stencil Manufacturing"
          description="High-precision solder paste stencils"
          isSelected={value === ProductType.STENCIL}
          onClick={() => onChange(ProductType.STENCIL)}
        />
      </div>
    </div>
  );
};
```

**2. Èí¢ÁΩëÂ≠óÊÆµSchema**
```typescript
// app/quote2/schema/stencilFormilySchema.ts
export const stencilFormilySchema: ISchema = {
  type: "object",
  properties: {
    // === Âü∫Á°Ä‰ø°ÊÅØ ===
    stencilMaterial: {
      type: "string",
      title: "Stencil Material",
      "x-component": "TabSelect",
      "x-component-props": {
        options: [
          { label: "Stainless Steel 304", value: StencilMaterial.STAINLESS_STEEL_304 },
          { label: "Stainless Steel 316L", value: StencilMaterial.STAINLESS_STEEL_316L },
          { label: "Nickel", value: StencilMaterial.NICKEL }
        ]
      }
    },
    
    stencilThickness: {
      type: "number", 
      title: "Stencil Thickness",
      "x-component": "TabSelect",
      "x-component-props": {
        options: Object.values(StencilThickness).map(val => ({
          label: `${val}mm`,
          value: val
        }))
      }
    },

    stencilProcess: {
      type: "string",
      title: "Manufacturing Process", 
      "x-component": "TabSelect",
      "x-component-props": {
        options: [
          { label: "Laser Cutting (Most Common)", value: StencilProcess.LASER_CUT },
          { label: "Electroforming (High Precision)", value: StencilProcess.ELECTROFORM },
          { label: "Chemical Etching (Fine Pitch)", value: StencilProcess.CHEMICAL_ETCH }
        ]
      }
    },

    frameType: {
      type: "string",
      title: "Frame Type",
      "x-component": "TabSelect", 
      "x-component-props": {
        options: [
          { label: "No Frame (Flexible)", value: FrameType.NO_FRAME },
          { label: "SMT Frame (Standard)", value: FrameType.SMT_FRAME },
          { label: "Custom Frame", value: FrameType.CUSTOM_FRAME }
        ]
      }
    },

    frameSize: {
      type: "object",
      title: "Frame Size (mm)",
      "x-component": "DimensionsInput",
      "x-reactions": {
        dependencies: ["frameType"],
        fulfill: {
          state: {
            visible: "{{$deps[0] !== 'no_frame'}}"
          }
        }
      }
    },

    // === Â∑•Ëâ∫Ë¶ÅÊ±Ç ===
    surfaceTreatment: {
      type: "string",
      title: "Surface Treatment",
      "x-component": "TabSelect",
      "x-component-props": {
        options: [
          { label: "None", value: "none" },
          { label: "Electropolishing", value: "electropolish" }, 
          { label: "Passivation", value: "passivation" }
        ]
      }
    },

    tensionMesh: {
      type: "boolean",
      title: "Tension Mesh Required",
      "x-component": "BooleanTabs",
      "x-component-props": {
        description: "Required for fine pitch components"
      }
    },

    fiducialMarks: {
      type: "boolean", 
      title: "Fiducial Marks",
      "x-component": "BooleanTabs"
    },

    // === Êï∞ÈáèÂíåÂ∞∫ÂØ∏ÔºàÂ§çÁî®Áé∞ÊúâÂ≠óÊÆµÔºâ===
    singleDimensions: fullWidth({
      type: "object",
      title: "Stencil Size (mm)",
      "x-component": "DimensionsInput"
    }),

    singleCount: {
      type: "number",
      title: "Quantity",
      "x-component": "QuantityInput"
    },

    // === ÁâπÊÆäË¶ÅÊ±Ç ===
    specialRequests: fullWidth({
      type: "string",
      title: "Special Requirements",
      "x-component": "TextArea",
      "x-component-props": {
        placeholder: "Any special requirements for your stencil..."
      }
    })
  }
};
```

### 3. ËÆ°ÁÆóÈÄªËæëÂ±Ç

#### A. Áªü‰∏ÄËÆ°ÁÆóÊé•Âè£
```typescript
// lib/calculators/productCalculator.ts
interface ProductCalculationResult {
  totalPrice: number;
  unitPrice: number;
  breakdown: Record<string, number>;
  notes: string[];
  leadTimeDays: number;
  leadTimeReason: string[];
  minOrderQty: number;
}

export interface ProductCalculator {
  calculatePrice(formData: any): ProductCalculationResult;
  calculateLeadTime(formData: any, startDate: Date): number;
  calculateWeight(formData: any): number;
}
```

#### B. Èí¢ÁΩë‰ª∑Ê†ºËÆ°ÁÆóÂô®
```typescript
// lib/calculators/stencilCalculator.ts
export class StencilCalculator implements ProductCalculator {
  calculatePrice(formData: any): ProductCalculationResult {
    const { 
      stencilMaterial, 
      stencilThickness, 
      stencilProcess, 
      frameType,
      singleDimensions, 
      singleCount 
    } = formData;

    // Âü∫Á°Ä‰ª∑Ê†ºËÆ°ÁÆó
    const area = singleDimensions.length * singleDimensions.width; // mm¬≤
    const basePrice = this.getBasePricePerMm2(stencilMaterial, stencilThickness);
    
    // Â∑•Ëâ∫Âä†‰ª∑
    const processMultiplier = this.getProcessMultiplier(stencilProcess);
    
    // Ê°ÜÊû∂Âä†‰ª∑
    const frameAddition = this.getFrameAddition(frameType, singleDimensions);
    
    // Êï∞ÈáèÊäòÊâ£
    const quantityDiscount = this.getQuantityDiscount(singleCount);
    
    const unitCost = (basePrice * area * processMultiplier + frameAddition) * quantityDiscount;
    const totalPrice = unitCost * singleCount;

    return {
      totalPrice,
      unitPrice: unitCost,
      breakdown: {
        "Material Cost": basePrice * area * singleCount,
        "Process Cost": (basePrice * area * (processMultiplier - 1)) * singleCount,
        "Frame Cost": frameAddition * singleCount,
        "Quantity Discount": totalPrice * (1 - quantityDiscount) * -1
      },
      notes: this.generatePriceNotes(formData),
      leadTimeDays: this.calculateLeadTime(formData, new Date()),
      leadTimeReason: this.getLeadTimeReasons(formData),
      minOrderQty: 1
    };
  }

  private getBasePricePerMm2(material: string, thickness: number): number {
    // Èí¢ÁΩëÂü∫Á°Ä‰ª∑Ê†ºË°® (CNY/mm¬≤)
    const priceMatrix = {
      [StencilMaterial.STAINLESS_STEEL_304]: {
        [StencilThickness.T0_08]: 0.015,
        [StencilThickness.T0_10]: 0.018,
        [StencilThickness.T0_12]: 0.022,
        [StencilThickness.T0_15]: 0.028,
        [StencilThickness.T0_20]: 0.035
      },
      [StencilMaterial.STAINLESS_STEEL_316L]: {
        [StencilThickness.T0_08]: 0.020,
        [StencilThickness.T0_10]: 0.025,
        [StencilThickness.T0_12]: 0.030,
        [StencilThickness.T0_15]: 0.038,
        [StencilThickness.T0_20]: 0.048
      },
      [StencilMaterial.NICKEL]: {
        [StencilThickness.T0_08]: 0.045,
        [StencilThickness.T0_10]: 0.055,
        [StencilThickness.T0_12]: 0.068,
        [StencilThickness.T0_15]: 0.085,
        [StencilThickness.T0_20]: 0.110
      }
    };

    return priceMatrix[material]?.[thickness] || 0.025;
  }

  private getProcessMultiplier(process: string): number {
    const multipliers = {
      [StencilProcess.LASER_CUT]: 1.0,
      [StencilProcess.ELECTROFORM]: 2.5,
      [StencilProcess.CHEMICAL_ETCH]: 1.8
    };
    return multipliers[process] || 1.0;
  }

  private getFrameAddition(frameType: string, dimensions: any): number {
    // Ê°ÜÊû∂ÈôÑÂä†Ë¥πÁî® (CNY)
    if (frameType === FrameType.NO_FRAME) return 0;
    if (frameType === FrameType.SMT_FRAME) return 150;
    if (frameType === FrameType.CUSTOM_FRAME) return 300;
    return 0;
  }

  private getQuantityDiscount(quantity: number): number {
    if (quantity >= 100) return 0.85; // 15% ÊäòÊâ£
    if (quantity >= 50) return 0.90;  // 10% ÊäòÊâ£  
    if (quantity >= 20) return 0.95;  // 5% ÊäòÊâ£
    return 1.0; // Êó†ÊäòÊâ£
  }

  calculateLeadTime(formData: any, startDate: Date): number {
    const { stencilProcess, frameType, singleCount } = formData;
    
    // Âü∫Á°ÄÂ∑•Êúü
    let baseDays = 3; // ÊøÄÂÖâÂàáÂâ≤Âü∫Á°Ä3Â§©
    
    // Â∑•Ëâ∫Âä†Êó∂
    if (stencilProcess === StencilProcess.ELECTROFORM) {
      baseDays += 4; // ÁîµÈì∏Â∑•Ëâ∫ÈúÄË¶ÅÈ¢ùÂ§ñ4Â§©
    } else if (stencilProcess === StencilProcess.CHEMICAL_ETCH) {
      baseDays += 2; // ÂåñÂ≠¶ËöÄÂàªÈ¢ùÂ§ñ2Â§©
    }
    
    // Ê°ÜÊû∂Âä†Êó∂
    if (frameType === FrameType.CUSTOM_FRAME) {
      baseDays += 2; // ÂÆöÂà∂Ê°ÜÊû∂È¢ùÂ§ñ2Â§©
    }
    
    // Êï∞ÈáèÂä†Êó∂
    if (singleCount > 50) {
      baseDays += 1; // Â§ßÊâπÈáèÈ¢ùÂ§ñ1Â§©
    }
    
    return baseDays;
  }

  calculateWeight(formData: any): number {
    // Èí¢ÁΩëÈáçÈáèËÆ°ÁÆó (kg)
    const { singleDimensions, stencilThickness, frameType, singleCount } = formData;
    
    const area = singleDimensions.length * singleDimensions.width; // mm¬≤
    const volume = area * stencilThickness; // mm¬≥
    const density = 7.9; // ‰∏çÈîàÈí¢ÂØÜÂ∫¶ g/cm¬≥
    
    // Âçï‰∏™Èí¢ÁΩëÈáçÈáè (kg)
    let singleWeight = (volume * density) / 1000000; // ËΩ¨Êç¢‰∏∫kg
    
    // Ê°ÜÊû∂ÈáçÈáè
    if (frameType === FrameType.SMT_FRAME) {
      singleWeight += 0.2; // SMTÊ°ÜÊû∂Á∫¶200g
    } else if (frameType === FrameType.CUSTOM_FRAME) {
      singleWeight += 0.35; // ÂÆöÂà∂Ê°ÜÊû∂Á∫¶350g
    }
    
    return singleWeight * singleCount;
  }

  private generatePriceNotes(formData: any): string[] {
    const notes: string[] = [];
    
    if (formData.stencilProcess === StencilProcess.ELECTROFORM) {
      notes.push("‚ö° Electroforming provides highest precision for fine pitch components");
    }
    
    if (formData.frameType === FrameType.CUSTOM_FRAME) {
      notes.push("üîß Custom frame pricing may vary based on requirements");
    }
    
    if (formData.singleCount >= 20) {
      notes.push("üí∞ Quantity discount applied");
    }
    
    return notes;
  }

  private getLeadTimeReasons(formData: any): string[] {
    const reasons: string[] = [];
    const { stencilProcess, frameType } = formData;
    
    reasons.push("üìê Stencil manufacturing lead time includes:");
    
    if (stencilProcess === StencilProcess.LASER_CUT) {
      reasons.push("‚Ä¢ Laser cutting: 1-2 days");
    } else if (stencilProcess === StencilProcess.ELECTROFORM) {
      reasons.push("‚Ä¢ Electroforming: 4-6 days (high precision)");
    } else if (stencilProcess === StencilProcess.CHEMICAL_ETCH) {
      reasons.push("‚Ä¢ Chemical etching: 3-4 days");
    }
    
    if (frameType !== FrameType.NO_FRAME) {
      reasons.push("‚Ä¢ Frame mounting: 1-2 days");
    }
    
    reasons.push("‚Ä¢ Quality inspection: 1 day");
    
    return reasons;
  }
}
```

#### C. Áªü‰∏ÄËÆ°ÁÆóHook
```typescript
// app/quote2/hooks/useProductCalculation.ts
export const useProductCalculation = () => {
  const formData = useQuoteFormData();
  const setCalValues = useQuoteStore((state) => state.setCalValues);
  
  const calculator = useMemo(() => {
    const productType = formData.productType || ProductType.PCB;
    
    if (productType === ProductType.STENCIL) {
      return new StencilCalculator();
    } else {
      return new PcbCalculator(); // ÂåÖË£ÖÁé∞ÊúâÁöÑPCBËÆ°ÁÆóÈÄªËæë
    }
  }, [formData.productType]);

  const calculateAll = useCallback(async () => {
    try {
      const priceResult = calculator.calculatePrice(formData);
      const weight = calculator.calculateWeight(formData);
      
      // ËÆ°ÁÆóËøêË¥π (Â§çÁî®Áé∞ÊúâÈÄªËæëÔºå‰º†ÂÖ•ÈáçÈáè)
      const shippingResult = await calculateShippingCost(formData, weight);
      
      setCalValues({
        totalPrice: priceResult.totalPrice,
        pcbPrice: priceResult.totalPrice,
        unitPrice: priceResult.unitPrice,
        breakdown: priceResult.breakdown,
        leadTimeDays: priceResult.leadTimeDays,
        leadTimeResult: {
          cycleDays: priceResult.leadTimeDays,
          reason: priceResult.leadTimeReason
        },
        shippingCost: shippingResult.finalCost,
        shippingWeight: weight,
        priceNotes: priceResult.notes,
        minOrderQty: priceResult.minOrderQty
      });
    } catch (error) {
      console.error('ËÆ°ÁÆóÂ§±Ë¥•:', error);
    }
  }, [formData, calculator, setCalValues]);

  return { calculateAll };
};
```

### 4. È°µÈù¢Êï¥Âêà

#### A. ‰øÆÊîπQuoteFormÁªÑ‰ª∂
```typescript
// app/quote2/components/QuoteForm.tsx
export function QuoteForm({ editId }: { editId?: string }) {
  const [productType, setProductType] = useState<ProductType>(ProductType.PCB);
  
  // Âä®ÊÄÅÈÄâÊã©schema
  const currentSchema = useMemo(() => {
    return productType === ProductType.PCB 
      ? pcbFormilySchema 
      : stencilFormilySchema;
  }, [productType]);
  
  // Âä®ÊÄÅÂ≠óÊÆµÂàÜÁªÑ
  const fieldGroups = useMemo(() => {
    return getFieldGroups(productType);
  }, [productType]);

  // Ë°®ÂçïÈÖçÁΩÆ
  const form = useMemo(() => {
    return createForm({
      initialValues: {
        ...DEFAULT_FORM_DATA,
        productType, // Ê∑ªÂä†‰∫ßÂìÅÁ±ªÂûã
      },
      effects() {
        // Áé∞Êúâeffects‰øùÊåÅ‰∏çÂèò
        onFieldValueChange('productType', (field) => {
          setProductType(field.value);
        });
      }
    });
  }, [productType]);

  return (
    <div className="quote-form-container">
      {/* ‰∫ßÂìÅÁ±ªÂûãÈÄâÊã©Âô® */}
      <ProductTypeSelector 
        value={productType} 
        onChange={setProductType} 
      />
      
      {/* Ë°®ÂçïÂÜÖÂÆπ */}
      <FormProvider form={form}>
        <div className="space-y-8">
          {fieldGroups.map((group, index) => (
            <QuoteFormGroupMemo
              key={`${productType}-${index}`}
              group={group}
              index={index}
              schema={currentSchema}
              SchemaField={SchemaField}
            />
          ))}
        </div>
        
        {/* ÂÖ∂‰ªñÁé∞ÊúâÁªÑ‰ª∂‰øùÊåÅ‰∏çÂèò */}
        <FileUploadSection />
        <AddressFormComponent />
        <QuoteFormActions />
      </FormProvider>
    </div>
  );
}
```

#### B. ‰øÆÊîπPriceSummaryÁªÑ‰ª∂
```typescript
// app/quote2/components/PriceSummary.tsx (ÂÖ≥ÈîÆ‰øÆÊîπ)
export default function PriceSummary() {
  const formData = useQuoteFormData();
  const { calculateAll } = useProductCalculation();
  
  // Ê†πÊçÆ‰∫ßÂìÅÁ±ªÂûãÈÄâÊã©ËÆ°ÁÆóÈÄªËæë
  const priceBreakdown = useMemo((): PriceBreakdown => {
    const productType = formData.productType || ProductType.PCB;
    
    if (productType === ProductType.STENCIL) {
      // ‰ΩøÁî®Èí¢ÁΩëËÆ°ÁÆóÂô®
      const calculator = new StencilCalculator();
      const result = calculator.calculatePrice(formData);
      
      return {
        totalPrice: convertCnyToUsd(result.totalPrice),
        unitPrice: convertCnyToUsd(result.unitPrice),
        detail: Object.fromEntries(
          Object.entries(result.breakdown).map(([key, value]) => 
            [key, convertCnyToUsd(value)]
          )
        ),
        notes: result.notes,
        minOrderQty: result.minOrderQty,
        leadTime: `${result.leadTimeDays} days`,
        totalCount: formData.singleCount || 0
      };
    } else {
      // ‰ΩøÁî®Áé∞ÊúâPCBËÆ°ÁÆóÈÄªËæë
      const { total, detail, notes } = calcPcbPriceV3(formData);
      // ... Áé∞ÊúâPCBËÆ°ÁÆóÈÄªËæë
    }
  }, [formData, convertCnyToUsd]);

  return (
    <div className="price-summary">
      {/* ‰∫ßÂìÅÁ±ªÂûãÊ†áËØÜ */}
      <div className="mb-4 flex items-center gap-2">
        <span className="text-2xl">
          {formData.productType === ProductType.STENCIL ? 'üìê' : 'üîß'}
        </span>
        <h2 className="text-xl font-semibold">
          {formData.productType === ProductType.STENCIL ? 'Stencil Quote' : 'PCB Quote'}
        </h2>
      </div>
      
      {/* ÂÖ∂‰ªñÁé∞ÊúâÂÜÖÂÆπ‰øùÊåÅ‰∏çÂèò */}
      {/* ... */}
    </div>
  );
}
```

### 5. ÁÆ°ÁêÜÂêéÂè∞Êâ©Â±ï

#### A. Êä•‰ª∑ÂàóË°®È°µÈù¢
```typescript
// app/admin/quotes/page.tsx
export default function AdminQuotesPage() {
  return (
    <div>
      <FilterBar>
        {/* Êñ∞Â¢û‰∫ßÂìÅÁ±ªÂûãÁ≠õÈÄâ */}
        <Select placeholder="Product Type">
          <option value="">All Products</option>
          <option value="pcb">üîß PCB</option>
          <option value="stencil">üìê Stencil</option>
        </Select>
        {/* ÂÖ∂‰ªñÁé∞ÊúâÁ≠õÈÄâÂô® */}
      </FilterBar>
      
      <DataTable 
        columns={[
          {
            key: "productType",
            title: "Type",
            render: (record) => {
              const type = record.pcb_spec?.productType || 'pcb';
              return type === 'stencil' ? 'üìê Stencil' : 'üîß PCB';
            }
          },
          // ... ÂÖ∂‰ªñÂàó‰øùÊåÅ‰∏çÂèò
        ]}
      />
    </div>
  );
}
```

#### B. Êä•‰ª∑ËØ¶ÊÉÖÈ°µÈù¢
```typescript
// app/admin/quotes/[id]/page.tsx
export default function QuoteDetailPage({ params }: { params: { id: string } }) {
  const { data: quote } = useQuery(['quote', params.id]);
  const productType = quote?.pcb_spec?.productType || 'pcb';
  
  return (
    <div>
      <QuoteHeader 
        productType={productType}
        quote={quote} 
      />
      
      {/* Ê†πÊçÆ‰∫ßÂìÅÁ±ªÂûãÊòæÁ§∫‰∏çÂêåÁöÑËßÑÊ†º‰ø°ÊÅØ */}
      {productType === 'stencil' ? (
        <StencilSpecDisplay spec={quote.pcb_spec} />
      ) : (
        <PcbSpecDisplay spec={quote.pcb_spec} />
      )}
      
      {/* ÂÖ∂‰ªñÈÄöÁî®‰ø°ÊÅØ‰øùÊåÅ‰∏çÂèò */}
      <AddressDisplay address={quote.shipping_address} />
      <AdminActions quote={quote} />
    </div>
  );
}
```

## üöÄ ÂÆûÊñΩËÆ°Âàí

### Èò∂ÊÆµ1ÔºöÂü∫Á°ÄÊû∂ÊûÑÂáÜÂ§á (2Â§©)
1. **Á±ªÂûãÂÆö‰πâÂàõÂª∫**
   - ÂàõÂª∫ `stencilTypes.ts` ÂíåÁõ∏ÂÖ≥Êûö‰∏æ
   - Êâ©Â±ï `ProductType` Êûö‰∏æ
   
2. **ËÆ°ÁÆóÂô®Êû∂ÊûÑÊê≠Âª∫**
   - ÂàõÂª∫ `ProductCalculator` Êé•Âè£
   - ÂÆûÁé∞ `StencilCalculator` Á±ª
   - ÂåÖË£ÖÁé∞ÊúâPCBËÆ°ÁÆóÈÄªËæë‰∏∫ `PcbCalculator`

3. **ÁªÑ‰ª∂Âü∫Á°ÄÊâ©Â±ï**
   - ÂàõÂª∫ `ProductTypeSelector` ÁªÑ‰ª∂
   - ‰øÆÊîπ `QuoteForm` ÊîØÊåÅ‰∫ßÂìÅÁ±ªÂûãÂàáÊç¢

### Èò∂ÊÆµ2ÔºöÈí¢ÁΩëÂäüËÉΩÂÆûÁé∞ (3Â§©)
1. **Â≠óÊÆµÂÆö‰πâÂÆåÊàê**
   - ÂÆåÊàê `stencilFormilySchema.ts`
   - ÂÆûÁé∞Èí¢ÁΩëÁâπÊúâÂ≠óÊÆµÁªÑ‰ª∂

2. **ËÆ°ÁÆóÈÄªËæëÂÆåÂñÑ**
   - ÂÆåÊàêÈí¢ÁΩë‰ª∑Ê†ºËÆ°ÁÆóÁÆóÊ≥ï
   - ÂÆûÁé∞Èí¢ÁΩë‰∫§ÊúüËÆ°ÁÆó
   - ÈÄÇÈÖçËøêË¥πËÆ°ÁÆóÔºàÈáçÈáèÂ∑ÆÂºÇÔºâ

3. **Ë°®ÂçïÈõÜÊàêÊµãËØï**
   - È™åËØÅÂ≠óÊÆµÂàáÊç¢ÂäüËÉΩ
   - ÊµãËØïÊï∞ÊçÆ‰øùÂ≠òÂíåËØªÂèñ

### Èò∂ÊÆµ3ÔºöÁïåÈù¢‰ºòÂåñÂíåÁÆ°ÁêÜÂêéÂè∞ (2Â§©)
1. **ÂâçÁ´Ø‰ΩìÈ™å‰ºòÂåñ**
   - ÂÆåÂñÑ‰∫ßÂìÅÁ±ªÂûãÂàáÊç¢Âä®Áîª
   - ‰ºòÂåñ‰ª∑Ê†ºÊòæÁ§∫Ê†ºÂºè
   - Ê∑ªÂä†Â∏ÆÂä©‰ø°ÊÅØ

2. **ÁÆ°ÁêÜÂêéÂè∞ÈÄÇÈÖç**
   - Êä•‰ª∑ÂàóË°®Ê∑ªÂä†‰∫ßÂìÅÁ±ªÂûãÁ≠õÈÄâ
   - Êä•‰ª∑ËØ¶ÊÉÖÈ°µÊîØÊåÅÈí¢ÁΩëËßÑÊ†ºÊòæÁ§∫
   - ÂØºÂá∫ÂäüËÉΩÊîØÊåÅÈí¢ÁΩëÊï∞ÊçÆ

### Èò∂ÊÆµ4ÔºöÊµãËØïÂíå‰∏äÁ∫ø (1Â§©)
1. **ÂäüËÉΩÊµãËØï**
   - Á´ØÂà∞Á´ØÊµãËØïÈí¢ÁΩëÊä•‰ª∑ÊµÅÁ®ã
   - ‰ª∑Ê†ºËÆ°ÁÆóÂáÜÁ°ÆÊÄßÈ™åËØÅ
   - ÁÆ°ÁêÜÂêéÂè∞ÂäüËÉΩÊµãËØï

2. **ÊÄßËÉΩ‰ºòÂåñ**
   - ‰ª£Á†ÅÂàÜÂâ≤‰ºòÂåñ
   - ÁºìÂ≠òÁ≠ñÁï•Ë∞ÉÊï¥

## üìä ÂÖ≥ÈîÆÊåáÊ†á

### ÊäÄÊúØÊåáÊ†á
- **‰ª£Á†ÅÂ§çÁî®Áéá**: >85% (Â§ßÈÉ®ÂàÜÁªÑ‰ª∂ÂíåÈÄªËæëÂ§çÁî®)
- **ÊÄßËÉΩÂΩ±Âìç**: <5% (Âä®ÊÄÅÂä†ËΩΩschema)
- **ÂÖºÂÆπÊÄß**: 100% (Áé∞ÊúâPCBÂäüËÉΩÂÆåÂÖ®ÂÖºÂÆπ)

### ‰∏öÂä°ÊåáÊ†á
- **ÂºÄÂèëÊïàÁéá**: 8Â§©ÂÆåÊàê vs ‰ªéÈõ∂ÂºÄÂèë15+Â§©
- **Áª¥Êä§ÊàêÊú¨**: Áªü‰∏ÄÊû∂ÊûÑÔºåÁª¥Êä§ÊàêÊú¨Èôç‰Ωé40%
- **Êâ©Â±ïÊÄß**: Êú™Êù•Êñ∞‰∫ßÂìÅÂèØÂú®2-3Â§©ÂÜÖÈõÜÊàê

## üîß ÊäÄÊúØÈ£éÈô©ÂíåËß£ÂÜ≥ÊñπÊ°à

### È£éÈô©1ÔºöÂ≠óÊÆµÊï∞ÊçÆÁ±ªÂûãÂÜ≤Á™Å
**Ëß£ÂÜ≥ÊñπÊ°à**: ‰ΩøÁî®TypeScript‰∏•Ê†ºÁ±ªÂûãÊ£ÄÊü•ÔºåÂú®ÁºñËØëÊúüÂèëÁé∞ÈóÆÈ¢ò

### È£éÈô©2ÔºöËÆ°ÁÆóÈÄªËæëÂ§çÊùÇÂ∫¶Â¢ûÂä†
**Ëß£ÂÜ≥ÊñπÊ°à**: ÈÄöËøáCalculatorÊ®°ÂºèÈöîÁ¶ªÂêÑ‰∫ßÂìÅËÆ°ÁÆóÈÄªËæëÔºå‰øùÊåÅ‰ª£Á†ÅÊ∏ÖÊô∞

### È£éÈô©3ÔºöÁé∞ÊúâÂäüËÉΩÂõûÂΩí
**Ëß£ÂÜ≥ÊñπÊ°à**: 
- ‰øùÊåÅÁé∞Êúâ‰ª£Á†ÅË∑ØÂæÑ‰∏çÂèò
- ÂÖÖÂàÜÁöÑÂõûÂΩíÊµãËØï
- ÁÅ∞Â∫¶ÂèëÂ∏ÉÁ≠ñÁï•

## üí° Êú™Êù•Êâ©Â±ï

### Êñ∞‰∫ßÂìÅÁ±ªÂûãÊîØÊåÅ
Âü∫‰∫éÊ≠§Êû∂ÊûÑÔºåÊú™Êù•ÂèØ‰ª•ËΩªÊùæÊ∑ªÂä†Ôºö
- SMTË¥¥ÁâáÊúçÂä° (`ProductType.ASSEMBLY`)
- ÂÖÉÂô®‰ª∂ÈááË¥≠ (`ProductType.COMPONENTS`)
- ÊµãËØïÊúçÂä° (`ProductType.TESTING`)

### Êâ©Â±ïÊ≠•È™§
1. Ê∑ªÂä†Êñ∞ÁöÑ‰∫ßÂìÅÁ±ªÂûãÊûö‰∏æ
2. ÂàõÂª∫ÂØπÂ∫îÁöÑ Calculator Á±ª
3. ÂÆö‰πâ FormilySchema
4. Ê∑ªÂä†Â≠óÊÆµÂàÜÁªÑÈÖçÁΩÆ
5. ÁÆ°ÁêÜÂêéÂè∞ÈÄÇÈÖç

ÊØè‰∏™Êñ∞‰∫ßÂìÅÁ±ªÂûãÈ¢ÑËÆ°ÂºÄÂèëÊó∂Èó¥Ôºö3-5Â§©

## üìã ÊÄªÁªì

Ê≠§ÊñπÊ°àÂú®‰øùÊåÅÁé∞ÊúâÁ≥ªÁªüÁ®≥ÂÆöÁöÑÂâçÊèê‰∏ãÔºåÈÄöËøáÊúÄÂ∞èÊîπÂä®ÂÆûÁé∞‰∫ÜÈí¢ÁΩëÊä•‰ª∑ÂäüËÉΩÁöÑÂÆåÊï¥ÈõÜÊàê„ÄÇÂÖ≥ÈîÆ‰ºòÂäøÔºö

1. **ÊúÄÂ∞èÈ£éÈô©**: Áé∞ÊúâPCBÂäüËÉΩÈõ∂ÂΩ±Âìç
2. **Âø´ÈÄü‰∫§‰ªò**: 8Â§©ÂÆåÊàêÂºÄÂèëÔºåÂØπÊØî‰ªéÈõ∂ÂºÄÂèëËäÇÁúÅ50%Êó∂Èó¥  
3. **È´òÂ∫¶Â§çÁî®**: Âú∞ÂùÄ„ÄÅÊîØ‰ªò„ÄÅÊñá‰ª∂‰∏ä‰º†Á≠âÊ†∏ÂøÉÂäüËÉΩ100%Â§çÁî®
4. **Êòì‰∫éÁª¥Êä§**: Áªü‰∏ÄÊû∂ÊûÑÔºåÊ∏ÖÊô∞ÁöÑ‰ª£Á†ÅÁªÑÁªá
5. **Âº∫Êâ©Â±ïÊÄß**: ‰∏∫Êú™Êù•‰∫ßÂìÅÊâ©Â±ïÊâì‰∏ãËâØÂ•ΩÂü∫Á°Ä

ÈÄöËøáÊ≠§ÊñπÊ°àÔºåÂèØ‰ª•Âø´ÈÄüËøõÂÖ•Èí¢ÁΩëÂ∏ÇÂú∫ÔºåÈ™åËØÅÂïÜ‰∏öÊ®°ÂºèÔºåÂêåÊó∂‰∏∫‰∫ßÂìÅÁ∫øÁöÑËøõ‰∏ÄÊ≠•Êâ©Â±ïÂ•†ÂÆöÊäÄÊúØÂü∫Á°Ä„ÄÇ

---

## üìà È°πÁõÆÂÆåÊàêÁä∂ÊÄÅ

### ‚úÖ Â∑≤ÂÆåÊàêÈò∂ÊÆµ

#### Èò∂ÊÆµ1ÔºöÂü∫Á°ÄÊû∂ÊûÑÂáÜÂ§á ‚úÖ
- ‚úÖ Á±ªÂûãÂÆö‰πâÁ≥ªÁªü (`stencilTypes.ts`)
- ‚úÖ ‰∫ßÂìÅËÆ°ÁÆóÂô®Êû∂ÊûÑ (`productCalculator.ts`, `stencilCalculator.ts`)
- ‚úÖ Áªü‰∏ÄËÆ°ÁÆóHook (`useProductCalculation.ts`)
- ‚úÖ ‰∫ßÂìÅÁ±ªÂûãÈÄâÊã©Âô® (`ProductTypeSelector.tsx`)

#### Èò∂ÊÆµ2ÔºöÈí¢ÁΩëÂäüËÉΩÂÆûÁé∞ ‚úÖ
- ‚úÖ Èí¢ÁΩëFormily Schema (`stencilFormilySchema.ts`)
- ‚úÖ ‰∫ßÂìÅSchemaÁÆ°ÁêÜ (`productSchemas.ts`)
- ‚úÖ Èí¢ÁΩë‰∏ìÁî®ÁªÑ‰ª∂ (Â∑•Ëâ∫ÊåáÂØº„ÄÅ‰ª∑Ê†ºËØ¥ÊòéÁ≠â)
- ‚úÖ ‰∏ªË°®ÂçïÈõÜÊàê (`QuoteForm.tsx`)

#### Èò∂ÊÆµ3ÔºöÁïåÈù¢‰ºòÂåñÂíå‰ª∑Ê†ºÊòæÁ§∫ ‚úÖ
- ‚úÖ Âä®ÊÄÅ‰ª∑Ê†ºÂ±ïÁ§∫ (`PriceSummary.tsx`)
- ‚úÖ Èí¢ÁΩë‰ª∑Ê†ºÊòéÁªÜÂíåËØ¥Êòé (`StencilPriceExplainer.tsx`)
- ‚úÖ Â∑•Ëâ∫ÊåáÂØºÁªÑ‰ª∂ (`StencilProcessGuide.tsx`)
- ‚úÖ FormilyÁªÑ‰ª∂Êâ©Â±ï

#### Èò∂ÊÆµ4ÔºöÂêéÁ´ØAPIÈÄÇÈÖç ‚úÖ
- ‚úÖ Êä•‰ª∑APIÂçáÁ∫ß (‰∫ßÂìÅÁ±ªÂûãÊ£ÄÊµã„ÄÅÊï∞ÊçÆÈ™åËØÅ)
- ‚úÖ ËÆ¢ÂçïÁÆ°ÁêÜAPI (`/api/admin/orders/[id]`)
- ‚úÖ ÁÆ°ÁêÜÁïåÈù¢ÈÄÇÈÖç (Èí¢ÁΩëËÆ¢ÂçïÂç°Áâá„ÄÅÂàÜÁ¶ªÊòæÁ§∫)
- ‚úÖ Áî®Êà∑ÁïåÈù¢ÈÄÇÈÖç (Áªü‰∏ÄËÆ¢ÂçïÊòæÁ§∫)
- ‚úÖ ÊµãËØïÈ™åËØÅÁ≥ªÁªü (`/test-stencil-quote`)

### üéä È°πÁõÆÊàêÊûú

#### ÊäÄÊúØÊàêÊûú
- **Êô∫ËÉΩ‰∫ßÂìÅÁ±ªÂûãÊ£ÄÊµã**ÔºöAPIËá™Âä®ËØÜÂà´Èí¢ÁΩë‰∏éPCBËÆ¢Âçï
- **Áªü‰∏ÄÊï∞ÊçÆÊ®°Âûã**ÔºöÂà©Áî®Áé∞Êúâ`pcb_quotes`Ë°®ÊîØÊåÅÂ§ö‰∫ßÂìÅÁ±ªÂûã
- **ÁªÑ‰ª∂ÊúÄÂ§ßÂ§çÁî®**ÔºöÂú∞ÂùÄ„ÄÅÊñá‰ª∂‰∏ä‰º†„ÄÅÊîØ‰ªòÊµÅÁ®ã100%Â§çÁî®
- **Á±ªÂûãÂÆâÂÖ®‰øùÈöú**ÔºöÂÆåÊï¥ÁöÑTypeScriptÁ±ªÂûãÂÆö‰πâ‰ΩìÁ≥ª

#### ‰∏öÂä°ÊàêÊûú
- **ÂÆåÊï¥Èí¢ÁΩëÊä•‰ª∑ÊµÅÁ®ã**Ôºö‰ªéÊä•‰ª∑Âà∞ËÆ¢ÂçïÁÆ°ÁêÜÁöÑÂÖ®ÊµÅÁ®ãÊîØÊåÅ
- **‰∏ì‰∏öÂ∑•Ëâ∫ÊåáÂØº**ÔºöÊøÄÂÖâÂàáÂâ≤„ÄÅÁîµÈì∏„ÄÅÂåñÂ≠¶ËöÄÂàªÂ∑•Ëâ∫ÂØπÊØîÂíåÂª∫ËÆÆ
- **ÈÄèÊòé‰ª∑Ê†º‰ΩìÁ≥ª**ÔºöÂü∫‰∫éÊùêË¥®+ÂéöÂ∫¶ÁöÑ‰ª∑Ê†ºÁü©ÈòµÔºåÂ∑•Ëâ∫Âä†‰ª∑Á≥ªÊï∞
- **ÁÆ°ÁêÜÁïåÈù¢‰ºòÂåñ**ÔºöÂàÜÁ¶ªÊòæÁ§∫PCBÂíåÈí¢ÁΩëËÆ¢ÂçïÔºå‰∏ì‰∏öÂåñÁÆ°ÁêÜ

#### Áî®Êà∑‰ΩìÈ™å
- **Êó†Áºù‰∫ßÂìÅÂàáÊç¢**ÔºöPCB ‚Üî Èí¢ÁΩë‰∏ÄÈîÆÂàáÊç¢ÔºåÊï∞ÊçÆÊô∫ËÉΩ‰øùÁïô
- **‰∏ì‰∏öËßÑÊ†ºÊòæÁ§∫**ÔºöÊ†πÊçÆ‰∫ßÂìÅÁ±ªÂûãÊòæÁ§∫ÂØπÂ∫îÁöÑÊäÄÊúØËßÑÊ†º
- **ËØ¶ÁªÜ‰ª∑Ê†ºÊòéÁªÜ**ÔºöÊùêÊñôË¥π„ÄÅÂ∑•Ëâ∫Ë¥π„ÄÅÊ°ÜÊû∂Ë¥π„ÄÅË°®Èù¢Â§ÑÁêÜË¥πÂàÜÈ°πÊòæÁ§∫
- **ÈáèÊäò‰ºòÊÉ†‰ΩìÁ≥ª**Ôºö20+‰ª∂5%ÊäòÊâ£Ôºå50+‰ª∂10%ÊäòÊâ£Ôºå100+‰ª∂15%ÊäòÊâ£

### üöÄ ÈÉ®ÁΩ≤Â∞±Áª™Áä∂ÊÄÅ

Á≥ªÁªüÁé∞Â∑≤ÂÆåÂÖ®ÂáÜÂ§áÊäïÂÖ•Áîü‰∫ß‰ΩøÁî®Ôºö

#### ÂâçÁ´ØÂäüËÉΩ ‚úÖ
- Èí¢ÁΩëÊä•‰ª∑Ë°®ÂçïÂÆåÊï¥ÂèØÁî®
- ‰ª∑Ê†ºËÆ°ÁÆóÂÆûÊó∂ÂáÜÁ°Æ
- Â∑•Ëâ∫ÊåáÂØº‰∏ì‰∏öËØ¶ÁªÜ
- ‰∫ßÂìÅÂàáÊç¢ÊµÅÁïÖËá™ÁÑ∂

#### ÂêéÁ´ØÊîØÊåÅ ‚úÖ  
- APIÊô∫ËÉΩËØÜÂà´‰∫ßÂìÅÁ±ªÂûã
- Êï∞ÊçÆÈ™åËØÅ‰∏•Ê†ºÂèØÈù†
- ËÆ¢ÂçïÁä∂ÊÄÅÁÆ°ÁêÜÂÆåÂñÑ
- Êï∞ÊçÆÂ∫ìÂÖºÂÆπÊÄßËâØÂ•Ω

#### ÁÆ°ÁêÜÂäüËÉΩ ‚úÖ
- Èí¢ÁΩëËÆ¢Âçï‰∏ìÁî®ÁïåÈù¢
- Áä∂ÊÄÅÊµÅËΩ¨Êìç‰Ωú‰æøÊç∑
- ËßÑÊ†º‰ø°ÊÅØÊòæÁ§∫‰∏ì‰∏ö
- ÊâπÈáèÁÆ°ÁêÜÂäüËÉΩÂÆåÂ§á

#### ÊµãËØïÈ™åËØÅ ‚úÖ
- APIÊµãËØïÈ°µÈù¢ÂèØÁî®Ôºö`/test-stencil-quote`
- ÂÆåÊï¥ÊµÅÁ®ãÈ™åËØÅÈÄöËøá
- Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÊ£ÄÊü•Êó†ËØØ
- ÊÄßËÉΩÂΩ±ÂìçÂæÆ‰πéÂÖ∂ÂæÆ

**üéØ Âª∫ËÆÆ‰∏ã‰∏ÄÊ≠•Ë°åÂä®**Ôºö
1. Âú®stagingÁéØÂ¢ÉËøõË°åÊúÄÁªàÈ™åÊî∂ÊµãËØï
2. ÈÖçÁΩÆÁîü‰∫ßÁéØÂ¢ÉÈí¢ÁΩë‰ª∑Ê†ºÂèÇÊï∞
3. Âà∂ÂÆöÈí¢ÁΩë‰∫ßÂìÅ‰∏äÁ∫øËê•ÈîÄÁ≠ñÁï•
4. ËÆ≠ÁªÉÂÆ¢ÊúçÂõ¢ÈòüÈí¢ÁΩë‰∫ßÂìÅÁü•ËØÜ 