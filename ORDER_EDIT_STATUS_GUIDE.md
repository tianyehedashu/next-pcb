# 订单编辑功能状态指南

## 概述
订单编辑功能允许用户和管理员在特定状态下修改订单信息。不同角色有不同的编辑权限。

## 用户编辑权限

### 可编辑状态
用户可以在以下状态下编辑订单：
- `created` - 订单已创建
- `pending` - 正在审核中
- `reviewed` - 已审核（初步）

### 不可编辑状态
用户在以下状态下无法编辑订单：
- `quoted` - 已报价（等待确认付款）
- `confirmed` - 已确认（等待付款）
- `paid` - 已付款
- `in_production` - 生产中
- `shipped` - 已发货
- `delivered` - 已交付
- `completed` - 已完成
- `cancelled` - 已取消

### 编辑影响
- 当用户编辑处于 `reviewed` 状态的订单时，订单状态会自动变为 `pending`（重新审核）
- 编辑会触发管理员重新审核流程

## 管理员编辑权限

### 可编辑状态
管理员可以编辑除以下状态外的所有订单：
- `completed` - 已完成
- `cancelled` - 已取消  
- `delivered` - 已交付

### 管理员特权
- 管理员有更灵活的状态转换权限
- 可以编辑已付款但未完成的订单
- 可以修改价格、交期等关键信息

## 编辑功能入口

### 用户端
1. **订单详情页面头部** - 主要编辑按钮
2. **编辑状态卡片** - 当可编辑时显示的提示卡片中的"Edit Now"按钮

### 管理员端
1. **管理员订单详情页面头部** - "编辑订单"按钮
2. 在新标签页中打开编辑页面，避免丢失当前管理员页面的状态

## 技术实现

### 状态检查逻辑
```typescript
// 用户编辑权限检查
const canEdit = order && ['created', 'pending', 'reviewed'].includes(order.status || '');

// 管理员编辑权限检查  
const canAdminEdit = !['completed', 'cancelled', 'delivered'].includes(order.status || '') && 
                   (!adminOrder || !['completed', 'cancelled', 'delivered'].includes(adminOrder.status || ''));
```

### 编辑页面路由
- 编辑URL格式：`/quote2?edit={orderId}`
- 支持通过URL参数传递订单ID进行编辑

## 用户体验设计

### 视觉提示
- **可编辑状态**：显示琥珀色警告卡片，提示可以编辑
- **不可编辑状态**：显示灰色信息卡片，说明当前状态不可编辑
- **按钮状态**：编辑按钮仅在可编辑状态下显示

### 状态说明
- 明确显示哪些状态可以编辑
- 解释为什么当前状态不能编辑
- 提供联系支持的建议（对于已付款订单）

## 安全考虑

### 权限验证
- 后端API会验证用户权限和订单状态
- 防止绕过前端检查进行非法编辑

### 状态一致性
- 编辑操作会触发状态历史记录
- 确保订单状态转换的合理性

## 未来扩展

### 可能的改进
1. 部分字段编辑权限（如只允许编辑地址，不允许编辑PCB规格）
2. 编辑审批流程（重要修改需要额外审批）
3. 编辑历史追踪（显示订单的修改历史）
4. 批量编辑功能（管理员批量修改多个订单） 