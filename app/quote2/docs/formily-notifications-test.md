# Formily 通知系统测试指南

## 测试环境设置

1. 启动开发服务器：
```bash
pnpm dev
```

2. 访问 quote2 页面：
```
http://localhost:3000/quote2
```

## 测试场景

### 1. 厚度自动调整测试

**操作步骤：**
1. 设置层数为 4 层
2. 设置外层铜厚为 2oz
3. 设置内层铜厚为 1oz
4. 将层数改为 2 层

**预期结果：**
- 应该在页面右上角显示厚度调整通知
- 通知类型为 warning（橙色）
- 消息内容说明厚度已自动调整

### 2. 最小线宽调整测试

**操作步骤：**
1. 设置层数为 2 层
2. 设置外层铜厚为 1oz
3. 设置最小线宽为 3/3mil
4. 将外层铜厚改为 2oz

**预期结果：**
- 显示最小线宽调整通知
- 说明当前线宽可能不适用于新的铜厚

### 3. 丝印颜色调整测试

**操作步骤：**
1. 设置阻焊颜色为绿色
2. 设置丝印颜色为绿色
3. 将阻焊颜色改为红色

**预期结果：**
- 显示丝印颜色调整通知
- 说明丝印颜色已自动调整以避免与阻焊颜色冲突

### 4. 出货方式变更测试

**操作步骤：**
1. 将出货方式从拼板改为单片
2. 或从单片改为拼板

**预期结果：**
- 显示出货方式变更通知
- 提示用户配置相应的参数

## 通知功能测试

### 1. 通知显示测试
- 通知应该出现在页面右上角
- 通知有不同的颜色（warning=橙色，info=蓝色，success=绿色）
- 通知包含标题、消息和详细信息

### 2. 通知交互测试
- 鼠标悬停时通知不会自动消失
- 鼠标离开后 4 秒自动消失
- 点击 X 按钮可以手动关闭
- 点击设置按钮显示更多选项

### 3. 通知控制测试
- 可以禁用特定字段的通知
- 可以禁用特定类型的通知
- 多个通知时显示"Clear All"按钮
- 最多显示 5 个通知

### 4. 防抖和去重测试
- 快速连续改变同一字段不会产生多个通知
- 相同的调整结果不会重复通知
- 5 秒内同一字段不会重复通知

## 调试信息

### 1. 浏览器控制台
打开浏览器开发者工具，查看控制台输出：
- 应该看到 Formily 字段变化的日志
- 应该看到自动调整的日志
- 应该看到通知发送的日志

### 2. 常见问题排查

**问题：通知不显示**
- 检查 form 实例是否正确传递给 AutoAdjustmentManager
- 检查 useFormilyNotifications hook 是否正确初始化
- 检查浏览器控制台是否有错误

**问题：通知显示但内容不正确**
- 检查 formilyHelpers.ts 中的调整函数是否正确
- 检查字段映射是否正确
- 检查消息生成逻辑

**问题：通知显示过多**
- 检查防抖设置是否合理
- 检查去重逻辑是否生效
- 调整 debounceDelay 参数

## 性能测试

### 1. 内存泄漏测试
- 长时间使用表单，观察内存使用情况
- 检查定时器是否正确清理
- 检查事件监听器是否正确移除

### 2. 响应性能测试
- 快速连续改变多个字段
- 观察通知响应时间
- 检查是否有卡顿现象

## 预期行为总结

1. **智能调整**：系统应该根据字段依赖关系自动调整值
2. **友好提示**：用户应该能清楚了解发生了什么变化
3. **用户控制**：用户可以控制通知的显示和类型
4. **性能优化**：不会产生过多的通知或影响性能
5. **稳定可靠**：不会因为通知系统导致表单功能异常

## 测试完成标准

- [ ] 所有测试场景都能正确触发通知
- [ ] 通知显示和交互功能正常
- [ ] 防抖和去重机制有效
- [ ] 用户控制选项工作正常
- [ ] 没有控制台错误
- [ ] 性能表现良好
- [ ] 用户体验友好 