<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatwoot Pure HTML Test</title>
  <style>
    body { font-family: sans-serif; padding: 2em; line-height: 1.6; }
    h1 { color: #333; }
    #status { padding: 1em; border-radius: 8px; margin-top: 1em; }
    .success { background-color: #e6ffed; border: 1px solid #b7e1c8; color: #006b2e; }
    .error { background-color: #fff0f0; border: 1px solid #ffb3b3; color: #c00; }
    code { background-color: #f0f0f0; padding: 0.2em 0.4em; border-radius: 4px; }
  </style>
</head>
<body>

  <h1>Chatwoot çº¯ HTML åŠ è½½æµ‹è¯•</h1>
  <p>è¿™ä¸ªé¡µé¢å°†å°è¯•ç”¨æœ€ç®€å•çš„æ–¹å¼åŠ è½½ Chatwoot SDKã€‚</p>
  <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼ŒæŸ¥çœ‹ Console å’Œ Network æ ‡ç­¾é¡µçš„è¾“å‡ºã€‚</p>
  
  <div id="status">æ­£åœ¨åŠ è½½...</div>

  <script>
    // è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„çœŸå® Website Token
    const WEBSITE_TOKEN = "fodaY99Yfs8rumjH1JAKMj21";
    const BASE_URL = "https://app.chatwoot.com";

    const statusDiv = document.getElementById('status');

    // æ£€æŸ¥ Token æ˜¯å¦å·²å¡«å†™
    if (WEBSITE_TOKEN.includes('è¯·åœ¨è¿™é‡Œå¡«å…¥')) {
      statusDiv.innerHTML = 'ğŸ”´ é”™è¯¯: è¯·åœ¨è„šæœ¬ä¸­å¡«å…¥ä½ çš„çœŸå® Website Tokenï¼';
      statusDiv.className = 'error';
      throw new Error("Chatwoot Token not set.");
    }

    // 1. è®¾ç½® Chatwoot å…¨å±€é…ç½®
    window.chatwootSettings = {
      hideMessageBubble: false,
      position: 'right',
      locale: 'en',
      type: 'standard',
      showPopoutButton: false, // ç¡®ä¿è¿™ä¸ªæ˜¯ false
    };

    // 2. åˆ›å»ºå¹¶åŠ è½½è„šæœ¬
    const script = document.createElement('script');
    script.async = true;
    script.defer = true;
    const cleanBaseUrl = BASE_URL.replace(/\/$/, '');
    script.src = `${cleanBaseUrl}/packs/js/sdk.js`;

    console.log(`æ­£åœ¨ä» ${script.src} åŠ è½½è„šæœ¬...`);

    // 3. ç›‘å¬åŠ è½½æˆåŠŸäº‹ä»¶
    script.onload = function() {
      console.log('âœ… Chatwoot è„šæœ¬åŠ è½½æˆåŠŸ (onload äº‹ä»¶è§¦å‘)');
      statusDiv.innerHTML = 'âœ… è„šæœ¬åŠ è½½æˆåŠŸï¼æ­£åœ¨åˆå§‹åŒ–...';
      statusDiv.className = 'success';
      
      // 4. åˆå§‹åŒ– SDK
      window.chatwootSDK.run({
        websiteToken: WEBSITE_TOKEN,
        baseUrl: cleanBaseUrl,
      });

      // ç›‘å¬ Chatwoot ready äº‹ä»¶
      window.addEventListener('chatwoot:ready', function () {
        console.log('âœ… Chatwoot SDK åˆå§‹åŒ–å®Œæˆ (ready äº‹ä»¶è§¦å‘)');
        statusDiv.innerHTML = 'âœ… è„šæœ¬åŠ è½½å¹¶åˆå§‹åŒ–æˆåŠŸï¼ä½ åº”è¯¥èƒ½çœ‹åˆ°èŠå¤©æŒ‰é’®äº†ã€‚';
        statusDiv.className = 'success';
      });
    };

    // 5. ç›‘å¬åŠ è½½å¤±è´¥äº‹ä»¶
    script.onerror = function(error) {
      console.error('ğŸ”´ Chatwoot è„šæœ¬åŠ è½½å¤±è´¥ (onerror äº‹ä»¶è§¦å‘)', error);
      statusDiv.innerHTML = `ğŸ”´ è„šæœ¬åŠ è½½å¤±è´¥ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ Network æ ‡ç­¾é¡µï¼Œçœ‹çœ‹ <code>sdk.js</code> çš„è¯·æ±‚çŠ¶æ€ã€‚`;
      statusDiv.className = 'error';
    };

    // 6. å°†è„šæœ¬æ·»åŠ åˆ°é¡µé¢
    document.head.appendChild(script);

  </script>
</body>
</html> 